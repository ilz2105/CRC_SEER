---
title: "EDA"
author: "lulu zhang"
date: "7/22/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(sas7bdat)
library(tidyr)
library(tidyverse)
library(SASxport)
library(dplyr)
require(haven)
library(car)
library(readxl)
library(here)
library(skimr) # install.packages('skimr')
library(kableExtra) # install.packages('kableExtra')
require(ggplot2)
require(sandwich)
require(msm)
```


```{r incidence.by.race, echo=FALSE}
seer = readxl::read_xlsx("./seer.xlsx", sheet = 2) %>% 
  mutate(
    race = as.factor(race),
    gender = as.factor(gender), 
    race = dplyr::recode(race, 
                  `1` = "Black",
                  `0`  = "White"),
    gender = dplyr::recode(gender, 
                    `0` = "Male",
                    `1` = "Female"),
    age_grp = as.factor(age_grp),
    age_grp = dplyr::recode(age_grp,
                            `0` = "25-29 year olds",
                            `1` = "30-34 year olds",
                            `2` = "35-39 year olds",
                            `3` = "40-44 year olds",
                            `4` = "45-49 year olds")
  )

black_inc = seer %>% 
  filter(race == "Black") %>% 
  ggplot( aes(x = period, y = rate))+
   geom_line(aes(color = gender)) +
  facet_wrap(~age_grp)+
   labs(
    title = "CRC inc rates from 1975-2014 among Blacks",
    x = "Periods (5-year groups)",
    y = "Inc Rate of CRC",
    caption = "by 5-year age groups (25-49)"
  )

white_inc = seer %>% 
  filter(race == "White") %>% 
  ggplot( aes(x = period, y = rate))+
   geom_line(aes(color = gender)) +
  facet_wrap(~age_grp)+
   labs(
 title = "CRC inc rates from 1975-2014 among Whites",
    x = "Periods (5-year groups)",
    y = "Inc Rate of CRC",
    caption = "by 5-year age groups (25-49)"
  )

black_inc
white_inc
```

```{r  echo=FALSE}
mean_wgts = read.csv("./rf_wghts.csv")
mean_wgts = mean_wgts %>% 
  mutate(
    gender = as.factor(gender),
    race = as.factor(race),
    race = dplyr::recode(race, 
                  `1` = "Black",
                  `0`  = "White"),
    gender = dplyr::recode(gender, 
                    `0` = "Male",
                    `1` = "Female"),
     age_grp = as.factor(age_grp),
    age_grp = dplyr::recode(age_grp,
                            `0` = "25-29 year olds",
                            `1` = "30-34 year olds",
                            `2` = "35-39 year olds",
                            `3` = "40-44 year olds",
                            `4` = "45-49 year olds"),
    activity_level..0_Mean = as.numeric(as.character(activity_level..0_Mean)),
    activity_level..1_Mean = as.numeric(as.character(activity_level..1_Mean)),
    activity_level..2_Mean = as.numeric(as.character(activity_level..2_Mean)),
    activity_level..3_Mean = as.numeric(as.character(activity_level..3_Mean)),
     alc_freq..5_Mean= as.numeric(as.character(alc_freq..5_Mean)),
    alc_freq..4_Mean= as.numeric(as.character(alc_freq..4_Mean)),
    alc_freq..3_Mean = as.numeric(as.character(alc_freq..3_Mean)),
    alc_freq..2_Mean = as.numeric(as.character(alc_freq..2_Mean)),
    alc_freq..1_Mean = as.numeric(as.character(alc_freq..1_Mean)),
     alc_freq..0_Mean = as.numeric(as.character(alc_freq..0_Mean)),
    avg_drinks_pday_pstyr.1_Mean = as.numeric(as.character(avg_drinks_pday_pstyr.1_Mean)),
    avg_drinks_pday_pstyr.2_Mean = as.numeric(as.character(avg_drinks_pday_pstyr.2_Mean)),
    avg_drinks_pday_pstyr.3_Mean = as.numeric(as.character(avg_drinks_pday_pstyr.3_Mean)),
    avg_drinks_pday_pstyr.4_Mean = as.numeric(as.character(avg_drinks_pday_pstyr.4_Mean)),
    age_grp = as.factor( age_grp)
  ) %>% 
  drop_na()


mean_wgts
```


```{r activity.level, echo=FALSE}
act_level_0 = mean_wgts%>% 
  ggplot( aes(x = period, y = activity_level..0_Mean) )+
   geom_line(aes(color = age_grp )) + 
  facet_wrap(~race+gender)+
  labs(
 title = "weighted means for little to no activity level by race & gender",
    x = "Periods (5-year groups)",
    y = "weighted mean",
    caption = "by 5-year age groups (25-49)")



act_level_1 = mean_wgts%>% 
  ggplot( aes(x = period, y = activity_level..1_Mean) )+
   geom_line(aes(color = age_grp )) + 
  facet_wrap(~race+gender)+
  labs(
 title = "weighted means for moderate activity level by race & gender",
    x = "Periods (5-year groups)",
    y = "weighted mean",
    caption = "by 5-year age groups (25-49)")


act_level_2 = mean_wgts%>% 
  ggplot( aes(x = period, y = activity_level..2_Mean) )+
   geom_line(aes(color = age_grp )) + 
  facet_wrap(~race+gender)+
  labs(
 title = "weighted means for moderate activity level by race and gender",
    x = "Periods (5-year groups)",
    y = "weighted mean",
    caption = "by 5-year age groups (25-49)")


act_level_3 = mean_wgts%>% 
  ggplot( aes(x = period, y = activity_level..3_Mean) )+
   geom_line(aes(color = age_grp )) + 
  facet_wrap(~race+gender)+
  labs(
 title = "weighted means for high activity level by race and gender",
    x = "Periods (5-year groups)",
    y = "weighted mean",
    caption = "by 5-year age groups (25-49)")



act_level_0
act_level_1
act_level_2
act_level_3

```

```{r alcohol, echo=FALSE}
alc_freq_5 = mean_wgts%>% 
  ggplot( aes(x = period, y = alc_freq..5_Mean) )+
   geom_line(aes(color = age_grp )) + 
  facet_wrap(~race+gender)+
  labs(
 title = "weighted means for alcohol frequency 5 by race & gender",
    x = "Periods (5-year groups)",
    y = "weighted mean",
    caption = "by 5-year age groups (25-49)")



alc_freq_4 = mean_wgts%>% 
  ggplot( aes(x = period, y = alc_freq..4_Mean) )+
   geom_line(aes(color = age_grp )) + 
  facet_wrap(~race+gender)+
  labs(
 title = "weighted means for alcohol frequency 4 by race & gender",
    x = "Periods (5-year groups)",
    y = "weighted mean",
    caption = "by 5-year age groups (25-49)")


alc_freq_3 = mean_wgts%>% 
  ggplot( aes(x = period, y = alc_freq..3_Mean) )+
   geom_line(aes(color = age_grp )) + 
  facet_wrap(~race+gender)+
  labs(
 title = "weighted means for alcohol frequency 3 by race and gender",
    x = "Periods (5-year groups)",
    y = "weighted mean",
    caption = "by 5-year age groups (25-49)")


alc_freq_2 = mean_wgts%>% 
  ggplot( aes(x = period, y = alc_freq..2_Mean) )+
   geom_line(aes(color = age_grp )) + 
  facet_wrap(~race+gender)+
  labs(
 title = "weighted means for alcohol frequency 2 by race and gender",
    x = "Periods (5-year groups)",
    y = "weighted mean",
    caption = "by 5-year age groups (25-49)")


alc_freq_1 = mean_wgts%>% 
  ggplot( aes(x = period, y = alc_freq..1_Mean) )+
   geom_line(aes(color = age_grp )) + 
  facet_wrap(~race+gender)+
  labs(
 title = "weighted means for alcohol frequency 1 by race and gender",
    x = "Periods (5-year groups)",
    y = "weighted mean",
    caption = "by 5-year age groups (25-49)")

alc_freq_0 = mean_wgts%>% 
  ggplot( aes(x = period, y = alc_freq..0_Mean) )+
   geom_line(aes(color = age_grp )) + 
  facet_wrap(~race+gender)+
  labs(
 title = "weighted means for alcohol frequency (none) by race and gender",
    x = "Periods (5-year groups)",
    y = "weighted mean",
    caption = "by 5-year age groups (25-49)")

alc_freq_0
alc_freq_1
alc_freq_2
alc_freq_3
alc_freq_4
alc_freq_5

```

